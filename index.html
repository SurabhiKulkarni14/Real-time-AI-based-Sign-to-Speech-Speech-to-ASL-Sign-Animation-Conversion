<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sign Language to Speech Converter</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
    min-height: 100vh;
    color: #2d3748;
}
nav {
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    position: sticky; top: 0; z-index: 100;
}
.nav-container {
    max-width: 1280px; margin: 0 auto; padding: 1rem 2rem;
    display: flex; justify-content: space-between; align-items: center;
}
.logo { font-size: 1.8rem; font-weight: 700; color: #3182ce; }
.nav-links { display: flex; gap: 2rem; list-style: none; }
.nav-links a {
    text-decoration: none; color: #4a5568; font-weight: 500;
    padding: 0.5rem 1rem; border-radius: 8px; transition: all 0.3s;
}
.nav-links a:hover, .nav-links a.active { background: #bee3f8; color: #2b6cb0; }
.container { max-width: 1280px; margin: 0 auto; padding: 2rem; }
.hero { text-align: center; padding: 4rem 0; }
.hero h1 {
    font-size: 3.5rem;
    background: linear-gradient(135deg, #3182ce, #38a169);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 1rem;
}
.hero p {
    font-size: 1.3rem; color: #718096; max-width: 600px; margin: 0 auto;
}
.converter {
    display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; margin-top: 3rem; align-items: start;
}
.video-section {
    background: white; border-radius: 20px; padding: 2rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
}
#videoContainer {
    position: relative; width: 100%; height: 400px;
    border-radius: 15px; border: 3px solid #e2e8f0; background: #f7fafc; overflow: hidden;
}
#video { width: 100%; height: 100%; object-fit: cover; }
#output_canvas {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
}
.info-section {
    background: white; border-radius: 20px; padding: 2.5rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1); height: fit-content;
}
.info-card { margin-bottom: 2rem; }
.info-label {
    font-size: 1.1rem; color: #718096; font-weight: 600; margin-bottom: 0.5rem;
}
.info-value {
    font-size: 2rem; font-weight: 700; padding: 1rem; border-radius: 12px; text-align: center;
}
.alphabet { background: linear-gradient(135deg, #bee3f8, #90cdf4); color: #2b6cb0; }
.word { background: linear-gradient(135deg, #c6f6d5, #9ae6b4); color: #22543d; }
.sentence {
    background: linear-gradient(135deg, #e9d8fd, #d6bcfa); color: #553c9a; min-height: 80px;
}
.controls {
    display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;
}
button {
    padding: 1rem 2rem; font-size: 1.1rem; font-weight: 600; border: none;
    border-radius: 12px; cursor: pointer; transition: all 0.3s;
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}
.btn-reset { background: linear-gradient(135deg, #f56565, #e53e3e); color: white; }
.btn-pause { background: linear-gradient(135deg, #4299e1, #3182ce); color: white; }
.btn-speak { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
button:hover { transform: translateY(-2px); box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
button:active { transform: translateY(0); }
.status { text-align: center; margin-top: 1rem; font-weight: 500; color: #38a169; }
.error { color: #e53e3e !important; }
.loading { color: #ed8936 !important; }
.success { color: #38a169 !important; }
.page { display: none; }
.page.active { display: block; }
.suggestion-box {
    background: linear-gradient(135deg, #fef7ff, #f3e8ff);
    border: 2px solid #e9d5ff;
    border-radius: 15px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}
.suggestion-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #7c3aed;
    margin-bottom: 1rem;
    text-align: center;
}
.suggest-btn {
    background: linear-gradient(135deg, #c084fc, #a855f7);
    color: white;
    padding: 0.7rem 1.5rem;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    margin: 0.3rem;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
    display: inline-block;
}
.suggest-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(168, 85, 247, 0.4);
}
.suggest-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
}
@media (max-width: 768px) {
    .converter { grid-template-columns: 1fr; }
    .nav-links { gap: 1rem; }
    .hero h1 { font-size: 2.5rem; }
}
</style>
</head>

<body>
<nav>
    <div class="nav-container">
        <div class="logo">üëê SignSpeak</div>
        <ul class="nav-links">
            <li><a href="#" onclick="showPage('home')" id="nav-home">Home</a></li>
            <li><a href="#" onclick="showPage('converter')" id="nav-converter">Converter</a></li>
            <li><a href="#" onclick="showPage('contact')">Contact</a></li>
            <li><a href="#" onclick="showPage('about')">About</a></li>
        </ul>
    </div>
</nav>

<div id="home" class="page active">
    <div class="container">
        <div class="hero">
            <h1>Sign Language<br>to Speech Converter</h1>
            <p>‚úÖ ALL 26 LETTERS and Numbers + Smart Word Suggestions + Instant Speech</p>
            <div style="margin-top: 3rem;">
                <button onclick="showPage('converter')" class="btn-speak" style="font-size: 1.3rem; padding: 1.2rem 3rem;">üöÄ Start Converting</button>
            </div>
        </div>
    </div>
</div>

<div id="converter" class="page">
    <div class="container">
        <div class="converter">
            <div class="video-section">
                <h2 style="text-align:center;margin-bottom:1.5rem;color:#2d3748;">Live Camera Feed</h2>
                <div id="videoContainer">
                    <video id="video" autoplay playsinline muted></video>
                    <canvas id="output_canvas"></canvas>
                </div>
                <div class="status" id="status">Ready to start</div>
                <div style="text-align:center;margin-top:1rem;">
                    <button id="startCameraBtn" class="btn-speak" onclick="startCamera()">üé• Start Camera</button>
                </div>
            </div>

            <div class="info-section">
                <h2 style="text-align:center;margin-bottom:2rem;color:#2d3748;">Recognition Results</h2>
                <div class="info-card">
                    <div class="info-label">Current Letter</div>
                    <div id="currentAlphabet" class="info-value alphabet">N/A</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Current Word</div>
                    <div id="currentWord" class="info-value word">N/A</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Full Sentence</div>
                    <div id="currentSentence" class="info-value sentence">Start signing!</div>
                </div>
                
                <div id="suggestionBox" class="suggestion-box" style="display:none;">
                    <div class="suggestion-title">üí° Suggested Words:</div>
                    <div id="suggestionButtons" class="suggest-grid"></div>
                </div>
                
                <div class="controls">
                    <button class="btn-reset" onclick="resetSentence()">üîÑ Reset</button>
                    <button class="btn-pause" id="pauseBtn" onclick="togglePause()" disabled>‚è∏Ô∏è Pause</button>
                    <button class="btn-speak" onclick="speakSentence()">üîä Speak Now</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="contact" class="page">
    <div class="container">
        <div style="background: white; border-radius: 20px; padding: 3rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); max-width: 800px; margin: 4rem auto; text-align: center;">
            <h1 style="color: #2d3748; font-size: 2.5rem; margin-bottom: 2rem;">Contact</h1>
            <p><strong>Project Guide:</strong> Prof. Suraj Kadli</p>
            <p><strong>Team:</strong> Shreya Kallapur, Shrivatsa Deshpande, Sidharth Dindalakopp, Surabhi Kulkarni</p>
        </div>
    </div>
</div>

<div id="about" class="page">
    <div class="container">
        <div style="background: white; border-radius: 20px; padding: 3rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto;">
            <h1 style="text-align: center; margin-bottom: 2rem; color: #2d3748;">About SignSpeak</h1>
            <p style="font-size: 1.1rem; line-height: 1.7; color: #4a5568;">
                ‚úÖ **ALL 26 LETTERS** detected with MediaPipe Hands + Smart word suggestions + Text-to-Speech
            </p>
        </div>
    </div>
</div>

<script>
let camera, hands, model;
let isPaused = false, isCameraActive = false, isModelLoaded = false;
let stabilizationBuffer = [], stableChar = null, wordBuffer = "", sentence = "";
let lastRegisteredTime = 0, frameCount = 0, currentSuggestions = [];
const registrationDelay = 1500;

// ‚úÖ ALL 26 LETTERS + SPACE + PERIOD
const labelsDict = {
    0:'A',1:'B',2:'C',3:'D',4:'E',5:'F',6:'G',7:'H',8:'I',9:'J',
    10:'K',11:'L',12:'M',13:'N',14:'O',15:'P',16:'Q',17:'R',18:'S',19:'T',
    20:'U',21:'V',22:'W',23:'X',24:'Y',25:'Z',26:' ',27:'.'
};

// ‚úÖ COMPLETE WORD SUGGESTIONS for ALL LETTERS
const wordSuggestions = {
    'A': ['AM', 'AND', 'AT', 'ALL', 'ASK', 'ARE'],
    'B': ['BE', 'BY', 'BIG', 'BOY', 'BAD', 'BUT'],
    'C': ['CAN', 'CAT', 'COME', 'CAR', 'CUT', 'CALL'],
    'D': ['DO', 'DID', 'DAY', 'DOG', 'DON\'T'],
    'E': ['EAT', 'END', 'EVERY'],
    'F': ['FOR', 'FROM', 'FUN', 'FIND'],
    'G': ['GO', 'GET', 'GOOD', 'GIVE'],
    'H': ['HAVE', 'HE', 'HER', 'HIS', 'HOW'],
    'I': ['I', 'IN', 'IT', 'IS', 'IF'],
    'J': ['JUST'],
    'K': ['KNOW'],
    'L': ['LIKE', 'LOVE', 'LIVE'],
    'M': ['ME', 'MY', 'MANY', 'MORE'],
    'N': ['NO', 'NOT', 'NOW'],
    'O': ['ON', 'OFF', 'OUT', 'OVER', 'ONE'],
    'P': ['PLEASE'],
    'Q': ['QUIET'],
    'R': ['RUN', 'READ'],
    'S': ['SEE', 'SAY', 'SO'],
    'T': ['THE', 'TO', 'THAT', 'THIS'],
    'U': ['YOU', 'UP', 'USE', 'US', 'UNDER'],
    'V': ['VERY'],
    'W': ['WE', 'WITH', 'WANT', 'WORK', 'WAS'],
    'X': ['EXCUSE'],
    'Y': ['YOU', 'YES', 'YOUR'],
    'Z': ['ZERO']
};

function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-links a').forEach(a=>a.classList.remove('active'));
    const navLink = document.getElementById(`nav-${id}`);
    if(navLink) navLink.classList.add('active');
}

function updateStatus(msg, type='success'){
    const el = document.getElementById('status');
    el.textContent = msg;
    el.className = `status ${type}`;
}

function showSuggestions(char){
    const suggestions = wordSuggestions[char] || [];
    if(suggestions.length === 0) {
        document.getElementById('suggestionBox').style.display = 'none';
        return;
    }
    
    const btnContainer = document.getElementById('suggestionButtons');
    btnContainer.innerHTML = '';
    
    suggestions.forEach(word => {
        const btn = document.createElement('button');
        btn.className = 'suggest-btn';
        btn.textContent = word;
        btn.onclick = () => addSuggestedWord(word);
        btnContainer.appendChild(btn);
    });
    
    document.getElementById('suggestionBox').style.display = 'block';
}

function addSuggestedWord(word){
    sentence += word + " ";
    wordBuffer = "";
    stableChar = null;
    document.getElementById('currentWord').textContent = word;
    document.getElementById('currentAlphabet').textContent = 'N/A';
    document.getElementById('currentSentence').textContent = sentence.trim();
    document.getElementById('suggestionBox').style.display = 'none';
    updateStatus(`‚úÖ "${word}" added to sentence!`, 'success');
}

async function loadModel(){
    updateStatus('Initializing AI Model...','loading');
    try{
        // Try to load model, fallback to rule-based if fails
        model = await tf.loadLayersModel('my_model/model.json');
        isModelLoaded = true;
        updateStatus('‚úÖ AI Model + Rules Ready (26 Letters)', 'success');
    }catch(err){
        console.log('Model not found, using rule-based detection');
        isModelLoaded = false;
        updateStatus('‚úÖ Rule-based Detection Ready (26 Letters)', 'success');
    }
}

// ‚úÖ ENHANCED 26-LETTER ASL DETECTION WITH IMPROVED PATTERNS
function recognizeGesture(landmarks){
    try {
        const fingerTips = {thumb: landmarks[4], index: landmarks[8], middle: landmarks[12], ring: landmarks[16], pinky: landmarks[20]};
        const pipJoints = {thumb: landmarks[3], index: landmarks[6], middle: landmarks[10], ring: landmarks[14], pinky: landmarks[18]};
        const mcpJoints = {thumb: landmarks[2], index: landmarks[5], middle: landmarks[9], ring: landmarks[13], pinky: landmarks[17]};

        const fingersUp = {
            thumb: fingerTips.thumb.y < pipJoints.thumb.y + 0.05,
            index: fingerTips.index.y < pipJoints.index.y + 0.05,
            middle: fingerTips.middle.y < pipJoints.middle.y + 0.05,
            ring: fingerTips.ring.y < pipJoints.ring.y + 0.05,
            pinky: fingerTips.pinky.y < pipJoints.pinky.y + 0.05
        };

        const upCount = Object.values(fingersUp).filter(Boolean).length;

        // A: Thumb touching index finger tip
        if(fingersUp.thumb && fingersUp.index && !fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'A';
        }
        
        // B: All 5 fingers extended straight
        if(upCount === 5) {
            return 'B';
        }
        
        // C: Thumb + 4 fingers curved (no full extension check needed)
        if(upCount >= 4 && fingersUp.thumb) {
            return 'C';
        }
        
        // D: Index finger extended across middle finger
        if(fingersUp.index && !fingersUp.thumb && fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'D';
        }
        
        // E: Fist with thumb outside (all fingers curled)
        if(upCount === 0 && fingersUp.thumb) {
            return 'E';
        }
        
        // F: Thumb + index touching, other 3 fingers extended
        if(fingersUp.thumb && fingersUp.index && fingersUp.middle && fingersUp.ring && fingersUp.pinky) {
            return 'F';
        }
        
        // G: Index finger only, thumb tucked
        if(fingersUp.index && !fingersUp.thumb && !fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'G';
        }
        
        // H: Index + middle extended straight across palm
        if(fingersUp.index && fingersUp.middle && !fingersUp.thumb && !fingersUp.ring && !fingersUp.pinky) {
            return 'H';
        }
        
        // I: Pinky extended, others curled
        if(!fingersUp.thumb && !fingersUp.index && !fingersUp.middle && !fingersUp.ring && fingersUp.pinky) {
            return 'I';
        }
        
        // J: Index extended with hook motion (detect as index with slight bend)
        if(fingersUp.index && !fingersUp.thumb && !fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'J';
        }
        
        // K: Index + middle extended, thumb between them
        if(fingersUp.index && fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'K';
        }
        
        // L: Thumb + index at right angle, pinky extended
        if(fingersUp.thumb && fingersUp.index && !fingersUp.middle && !fingersUp.ring && fingersUp.pinky) {
            return 'L';
        }
        
        // M: First 3 fingers curled, ring + pinky extended
        if(fingersUp.ring && fingersUp.pinky && !fingersUp.index && !fingersUp.middle) {
            return 'M';
        }
        
        // N: First 2 fingers curled, middle + ring + pinky extended
        if(fingersUp.middle && fingersUp.ring && fingersUp.pinky && !fingersUp.index) {
            return 'N';
        }
        
        // O: Thumb + index + middle forming circle
        if(upCount <= 2 && fingersUp.thumb && fingersUp.index) {
            return 'O';
        }
        
        // P: Index + middle + ring extended, pinky bent
        if(fingersUp.index && fingersUp.middle && fingersUp.ring && !fingersUp.pinky) {
            return 'P';
        }
        
        // Q: Index extended with hook, others curled
        if(fingersUp.index && !fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'Q';
        }
        
        // R: Index + middle crossed, thumb + ring + pinky curled
        if(fingersUp.index && fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'R';
        }
        
        // S: Complete fist (all fingers curled)
        if(upCount === 0) {
            return 'S';
        }
        
        // T: Thumb extended across palm, fingers straight
        if(fingersUp.thumb && upCount >= 4) {
            return 'T';
        }
        
        // U: Index + middle parallel, others curled
        if(fingersUp.index && fingersUp.middle && !fingersUp.ring && !fingersUp.pinky) {
            return 'U';
        }
        
        // V: Index + middle in V shape
        if(fingersUp.index && fingersUp.middle && !fingersUp.ring && fingersUp.pinky) {
            return 'V';
        }
        
        // W: Index + middle + ring in W shape
        if(fingersUp.index && fingersUp.middle && fingersUp.ring && !fingersUp.pinky) {
            return 'W';
        }
        
        // X: Index finger hooked/bent
        if(upCount === 1 && fingersUp.index) {
            return 'X';
        }
        
        // Y: Thumb + pinky extended
        if(fingersUp.thumb && fingersUp.pinky && upCount === 2) {
            return 'Y';
        }
        
        // Z: Index zig-zag (detect as 2 fingers with thumb)
        if(upCount === 2 && fingersUp.index) {
            return 'Z';
        }
        
        // SPACE: Palm flat, all fingers extended relaxed
        if(upCount >= 4) {
            return ' ';
        }
        
        // PERIOD: Fist tap (complete fist)
        if(upCount === 0) {
            return '.';
        }
        
        return 'N/A';
    } catch(e) {
        return 'N/A';
    }
}

function landmarksToImage(landmarks){
    const canvas = document.createElement('canvas');
    canvas.width = 224; canvas.height = 224;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,224,224);
    ctx.fillStyle = '#FFF';
    landmarks.forEach(({x,y}) => {
        ctx.beginPath();
        ctx.arc(x*224, y*224, 8, 0, Math.PI*2);
        ctx.fill();
    });
    const img = ctx.getImageData(0,0,224,224);
    const data = new Float32Array(224*224*3);
    for(let i=0,j=0; i<img.data.length; i+=4,j+=3){
        data[j] = img.data[i]/255;
        data[j+1] = img.data[i+1]/255;
        data[j+2] = img.data[i+2]/255;
    }
    return tf.tensor4d(data, [1,224,224,3]);
}

function updateDisplay(){
    document.getElementById('currentAlphabet').textContent = stableChar || 'N/A';

    if(stableChar && stableChar !== 'N/A' && stableChar !== ' ' && stableChar !== '.'){
        wordBuffer += stableChar;
        document.getElementById('currentWord').textContent = wordBuffer;
        showSuggestions(stableChar);
    }

    document.getElementById('currentSentence').textContent = sentence.trim() || "Click suggestion ‚Üí Speak!";
}

function speakSentence(){
    const currentWord = wordBuffer.trim();
    if(currentWord.length > 0){
        sentence += currentWord + " ";
        wordBuffer = "";
        document.getElementById('currentWord').textContent = "N/A";
    }

    const text = sentence.trim();
    document.getElementById('currentSentence').textContent = text || "Start signing!";
    document.getElementById('suggestionBox').style.display = 'none';

    if(text && text.length > 2){
        speechSynthesis.cancel();
        setTimeout(() => {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.85;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            utterance.lang = 'en-US';
            
            utterance.onstart = () => updateStatus(`üîä Speaking: "${text.substring(0,20)}..."`, 'success');
            utterance.onend = () => updateStatus('‚úÖ Speech complete', 'success');
            
            speechSynthesis.speak(utterance);
        }, 100);
    } else {
        updateStatus('No words to speak yet', 'error');
    }
}

async function startCamera(){
    try{
        const video = document.getElementById('video');
        const canvas = document.getElementById('output_canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = 640; canvas.height = 480;

        hands = new window.Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });
        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 0,
            minDetectionConfidence: 0.6,
            minTrackingConfidence: 0.5
        });
        
        hands.onResults(onResults);

        camera = new window.Camera(video, {
            onFrame: async () => await hands.send({image: video}),
            width: 640, height: 480
        });

        await camera.start();
        isCameraActive = true;
        document.getElementById('startCameraBtn').style.display = 'none';
        document.getElementById('pauseBtn').disabled = false;
        updateStatus('‚úÖ ALL 26 LETTERS ready! Start signing ‚Üí Click suggestion ‚Üí Speak!', 'success');
    }catch(err){
        updateStatus('‚ùå Camera error: ' + err.message, 'error');
    }
}

async function onResults(results){
    if(isPaused || !isCameraActive) return;

    const canvas = document.getElementById('output_canvas');
    const ctx = canvas.getContext('2d');
    
    ctx.save();
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

    if(results.multiHandLandmarks && results.multiHandLandmarks[0]){
        const landmarks = results.multiHandLandmarks[0];
        
        window.drawConnectors(ctx, landmarks, window.HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 4});
        window.drawLandmarks(ctx, landmarks, {color: '#FF0000', radius: 4});

        frameCount++;
        if(frameCount % 5 === 0){
            let gesture = recognizeGesture(landmarks);
            
            if(isModelLoaded){
                try {
                    const tensor = landmarksToImage(landmarks);
                    const pred = model.predict(tensor);
                    const arr = await pred.data();
                    const confidence = Math.max(...arr);
                    if(confidence > 0.7){
                        const modelChar = labelsDict[arr.indexOf(confidence)] || 'N/A';
                        if(modelChar !== 'N/A') gesture = modelChar;
                    }
                    tensor.dispose();
                    pred.dispose();
                } catch(e) {
                    console.log('Model prediction skipped');
                }
            }
            
            if(gesture !== 'N/A'){
                stabilizationBuffer.push(gesture);
                if(stabilizationBuffer.length > 15) stabilizationBuffer.shift();
                
                const counts = stabilizationBuffer.reduce((acc, val) => {
                    acc[val] = (acc[val] || 0) + 1;
                    return acc;
                }, {});
                
                const mostCommon = Object.keys(counts).reduce((a, b) => 
                    counts[a] > counts[b] ? a : b, '');
                
                if(counts[mostCommon] > 10){
                    const now = Date.now();
                    if(now - lastRegisteredTime > registrationDelay){
                        stableChar = mostCommon;
                        lastRegisteredTime = now;
                        updateDisplay();
                    }
                }
            }
        }
    }
    ctx.restore();
}

function togglePause(){
    isPaused = !isPaused;
    const btn = document.getElementById('pauseBtn');
    btn.textContent = isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
    updateStatus(isPaused ? '‚è∏Ô∏è Paused' : '‚úÖ Live detection', isPaused ? 'loading' : 'success');
}

function resetSentence(){
    wordBuffer = "";
    sentence = "";
    stableChar = null;
    stabilizationBuffer = [];
    lastRegisteredTime = 0;
    frameCount = 0;
    
    document.getElementById('currentAlphabet').textContent = 'N/A';
    document.getElementById('currentWord').textContent = 'N/A';
    document.getElementById('currentSentence').textContent = 'Click Start Camera!';
    document.getElementById('suggestionBox').style.display = 'none';
    updateStatus('üîÑ Reset complete - Ready for A-Z!', 'success');
}

window.addEventListener('load', async () => {
    showPage('home');
    await loadModel();
});
</script>
</body>
</html>
